D Java 反射的实现，我们可以从
 **获取 Class 对象**、
 **访问成员变量**、
 **调用方法**
 这几个核心步骤入手，用简单的示例一步步演示。

### 一、什么是反射？

反射是 Java 的一种**运行时机制**，允许我们在程序运行时 “窥探” 并操作类的内部结构（比如私有变量、私有方法），即使这些成员被`private`修饰，也能通过反射访问。

### 二、反射的核心步骤与示例

我们以一个简单的类`Student`为例，演示反射的实现过程：

```java
class Student {
    private String name = "小明"; // 私有成员变量
    private int age = 18;        // 私有成员变量

    // 私有方法
    private void study(String subject) {
        System.out.println(name + "正在学习" + subject);
    }
}
```

#### 步骤 1：获取`Class`对象（反射的入口）

要操作类的成员，首先需要获取该类的`Class`对象，有三种常见方式：

```java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        // 方式1：类名.class（最直接）
        Class<Student> clazz1 = Student.class;

        // 方式2：对象.getClass()
        // 必须要获得类的对象
        Student student = new Student();
        Class<? extends Student> clazz2 = student.getClass();

        // 方式3：Class.forName("全类名")
        //最常用
        Class<?> clazz3 = Class.forName("Student"); 

        // 验证三种方式获取的是同一个Class对象
        System.out.println(clazz1 == clazz2); // 输出true
        System.out.println(clazz1 == clazz3); // 输出true
    }
}
```

#### 步骤 2：访问**私有成员变量**（Field）

通过`Field`类可以访问类的成员变量，包括私有变量。需要先调用`setAccessible(true)`来 “打破”`private`的访问限制。

java

运行

```java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        Class<Student> clazz = Student.class;
        Student student = clazz.newInstance(); // 创建Student对象（也可用new Student()）

        // 1. 获取私有字段name
        Field nameField = clazz.getDeclaredField("name");
        // 开启访问权限（打破private限制）
        nameField.setAccessible(true);
        // 获取name的值
        String name = (String) nameField.get(student);
        System.out.println("原始name：" + name); // 输出：原始name：小明

        // 2. 修改私有字段name
        nameField.set(student, "小红");
        String newName = (String) nameField.get(student);
        System.out.println("修改后name：" + newName); // 输出：修改后name：小红

        // 3. 同理访问age字段
        Field ageField = clazz.getDeclaredField("age");
        ageField.setAccessible(true);
        int age = (int) ageField.get(student);
        System.out.println("年龄：" + age); // 输出：年龄：18
    }
}
```

#### 步骤 3：调用**私有方法**（Method）

通过`Method`类可以调用类的方法，包括私有方法，同样需要`setAccessible(true)`。

java

运行

```java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        Class<Student> clazz = Student.class;
        Student student = clazz.newInstance();

        // 获取私有方法study，参数为String类型
        Method studyMethod = clazz.getDeclaredMethod("study", String.class);
        studyMethod.setAccessible(true);

        // 调用方法，传入参数"Java"
        studyMethod.invoke(student, "Java"); // 输出：小红正在学习Java
    }
}
```

#### 步骤 4：创建对象（Constructor）

还可以通过`Constructor`类调用类的构造方法来创建对象（不过直接用`clazz.newInstance()`更简单，前提是类有无参构造）。

java

运行

```java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        Class<Student> clazz = Student.class;
        // 获取无参构造器
        Constructor<Student> constructor = clazz.getConstructor();
        Student student = constructor.newInstance(); // 等价于new Student()
    }
}
```

### 三、反射的使用场景与注意事项

- **使用场景**：框架底层（如 Spring 的依赖注入、MyBatis 的 SQL 映射）、动态加载类、工具类（如对象拷贝、JSON 序列化）等。
- **注意事项**：
    - 反射会**破坏封装性**（私有成员被公开访问），需谨慎使用；
    - 反射的**性能略低于直接调用**（因为是运行时解析），高频场景需优化；
    - 代码可读性差，维护成本高，非必要不建议用。