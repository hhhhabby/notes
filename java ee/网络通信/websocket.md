### 一、长轮询

- **定义**：基于 HTTP 的伪实时通信方案，属半双工。
- **核心流程**：客户端发起 HTTP 请求 → 服务器挂起连接至有数据 / 超时 → 响应后客户端立即重发请求，循环往复。
- **特点**：依赖 HTTP 协议，无需额外实现，但连接复用性差，服务器资源消耗较高。

### 二、TCP 全双工

- **定义**：TCP 传输层的固有特性，指通信双方可在同一连接上同时双向传输数据。
- **核心特点**：提供可靠字节流传输，但**无内置消息边界**（无法区分完整消息），需应用层自行定义数据解析规则。
- **定位**：所有上层实时通信协议（含 WebSocket）的底层传输基础。

### 三、WebSocket

#### 1. 连接升级过程

基于 TCP，通过 HTTP 握手完成升级，步骤如下：

1. **客户端请求**：发送 HTTP 请求，携带`Upgrade: websocket`、`Connection: Upgrade`等头部，声明升级意图。
2. **服务器确认**：返回`101 Switching Protocols`状态码，完成握手验证。
3. **升级完成**：连接脱离 HTTP，基于 TCP 进入 WebSocket 全双工模式。

#### 2. 消息结构（头 + 体）

- **消息头**：2~14 字节，含控制字段（如`FIN`（是否为最后一帧）、`Opcode`（帧类型：文本 / 二进制 / 关闭等）、`Payload Length`（消息体长度）等），用于解析消息属性。
- **消息体**：即实际传输的有效数据（文本或二进制），需结合消息头的掩码 / 长度信息解析。

### 总结

- 长轮询：HTTP 层的过渡方案，实时性与效率有限；
- TCP 全双工：底层传输能力，需上层协议封装消息逻辑；
- WebSocket：基于 TCP 的应用层协议，通过 HTTP 升级建立连接，自带消息结构，是网页实时通信的标准方案。