and name like concat('%', #{name}, '%')


### 1. 第一种写法的核心问题：SQL 语法错误导致查询失败

当`name`参数为`null`或空字符串时，第一种写法的 SQL 会被拼接为：

sql

```sql
select ... where limit #{page}, #{pageSize}
```

这是**语法错误的 SQL**（`where`关键字后没有任何条件，直接跟`limit`）。此时数据库会拒绝执行该 SQL，并抛出**SQL 语法异常**（如 MySQL 的`You have an error in your SQL syntax`）。

![[Pasted image 20251014194432.png]]
### 2. 为什么会出现 “访问空” 或类似 “索引越界” 的现象？

如果程序没有正确处理 SQL 执行异常，可能会导致后续逻辑出错：

- 假设程序预期从查询结果中获取数据（例如用`List.get(0)`获取第一条记录），但由于 SQL 执行失败，返回的结果集可能为`null`或空列表。
- 此时若程序直接访问结果集（如`list.get(0)`），就会因 “空列表访问索引 0” 而抛出**索引越界异常**（本质是程序未判断结果集是否为空导致的）。

简单说：**第一种写法的 SQL 语法错误→查询失败→结果集为空 / 异常→程序未处理空结果→触发 “访问空” 或索引越界**。

### 3. 第二种写法如何避免这种问题？

第二种写法用`<where>`标签 +`<if>`判断，当`name`为空时，SQL 会被正确拼接为：

sql

```sql
select ... limit #{page}, #{pageSize}
```

